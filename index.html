<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="미국주식 및 한국주식 물타기 계산기 (Stock Averaging Calculator). 목표 평단가 역계산, 수익률 시뮬레이션, 실시간 환율을 적용한 원화 환산까지 지원하는 전문 투자자용 도구입니다.">
    <meta name="keywords" content="물타기 계산기, 주식 평단가 계산기, 주식 물타기, 평단가 수정, 미국주식 환율, 스톡 캘큘레이터, 주식 수익률 계산">
    <meta name="author" content="Stock Pro">
    <title>Stock Pro - 주식 물타기 계산기 & 목표 평단 분석</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css"/>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7507549082424652"
     crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="background-overlay"></div>
    
    <header class="header">
        <div class="header-content">
            <h1 class="logo">
                <i class="fas fa-chart-pie"></i>
                STOCK PRO
            </h1>
            <p class="subtitle">Advanced Averaging Calculator</p>
            
            <div id="exchange-rate" class="exchange-rate-display" title="제공되는 환율 정보의 마지막 업데이트 시각이며, 사용자의 현재 위치 시간으로 표시됩니다.">
                <div class="rate-header">
                    <span class="currency-change" id="usd-krw-change"></span>
                    <button id="refresh-rate-btn" class="refresh-btn" title="환율 새로고침">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="rate-info">
                    <span class="currency-label">USD/KRW</span>
                    <span class="currency-value" id="usd-krw-rate">loading...</span>
                </div>
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- 기존 계산기 영역 -->
        <div class="calculator-wrapper">
            <!-- Settings Bar -->
            <div class="settings-bar">
                <div class="input-item stock-name-input">
                    <i class="fas fa-tag"></i>
                    <input type="text" id="stock-name" placeholder="종목명 (선택사항, 예: TSLA)">
                </div>
                <div class="toggle-item">
                    <label class="toggle-switch">
                        <input type="checkbox" id="include-fees">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">수수료 포함 (0.25%)</span>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="us-stock">
                    <span class="fi fi-us"></span>
                    미국주식 ($)
                </button>
                <button class="tab-btn" data-tab="kr-stock">
                    <span class="fi fi-kr"></span>
                    한국주식 (₩)
                </button>
            </div>

            <!-- 계산기 입력 폼 (공통 사용, 통화 기호만 변경) -->
            <div class="calculator-section">
                
                <div class="input-grid">
                    <!-- 보유 주식 섹션 -->
                    <div class="section-group">
                        <h3><i class="fas fa-wallet"></i> 현재 보유 자산</h3>
                        <div class="input-group">
                            <label>보유 수량</label>
                            <input type="number" id="current-shares" placeholder="0" step="1">
                        </div>
                        <div class="input-group">
                            <label>평균 단가</label>
                            <input type="number" id="current-price" placeholder="0" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>현재 시장가</label>
                            <input type="number" id="market-price" placeholder="0" step="0.01">
                        </div>
                    </div>

                    <!-- 추가 매수 섹션 -->
                    <div class="section-group">
                        <h3><i class="fas fa-cart-plus"></i> 추가 매수 계획</h3>
                        
                        <!-- 탭형 서브 메뉴: 직접 입력 vs 역계산 -->
                        <div class="calc-mode-tabs">
                            <button class="mode-btn active" onclick="setCalcMode('manual')">수량 직접 입력</button>
                            <button class="mode-btn" onclick="setCalcMode('target')">목표 평단 역계산</button>
                        </div>

                        <div id="mode-manual" class="mode-content active">
                            <div class="input-group">
                                <label>추가 매수 수량</label>
                                <input type="number" id="additional-shares" placeholder="0" step="1">
                            </div>
                            <div class="input-group">
                                <label>매수 희망가</label>
                                <input type="number" id="additional-price" placeholder="0" step="0.01">
                            </div>
                        </div>

                        <div id="mode-target" class="mode-content">
                            <div class="input-group highlight">
                                <label>목표 평균 단가</label>
                                <input type="number" id="target-avg-price" placeholder="희망하는 평단가 입력" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>매수 희망가 (선택)</label>
                                <input type="number" id="target-buy-price" placeholder="미입력 시 현재 시가 적용" step="0.01">
                            </div>
                            <p class="help-text">목표 평단을 맞추기 위해 필요한 주식 수를 계산합니다.</p>
                        </div>
                    </div>
                </div>

                <!-- 고급 옵션 (환율 등) -->
                <div class="advanced-options">
                    <div class="input-group" id="orig-rate-group" style="display: none;">
                        <label>최초 매수 시 환율 (선택: 환차손익 계산용)</label>
                        <input type="number" id="original-exchange-rate" placeholder="미입력시 현재 환율 적용">
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="reset-btn" onclick="resetCalculator()">
                        <i class="fas fa-undo"></i> 초기화
                    </button>
                    <button class="calculate-btn" onclick="calculate()">
                        <i class="fas fa-calculator"></i> 분석 실행
                    </button>
                </div>
            </div>
        </div>

        <!-- 결과 대시보드 -->
        <div class="results-section" id="results" style="display: none;">
            <div class="results-toolbar">
                <h2><i class="fas fa-poll"></i> 투자 분석 리포트</h2>
                <button class="save-btn" onclick="saveAsImage()">
                    <i class="fas fa-download"></i> 이미지 저장
                </button>
            </div>

            <div id="capture-area" class="capture-container">
                <!-- 0. 목표 달성 가이드 (역계산 시 노출) -->
                <div class="target-action-card" id="res-target-action" style="display: none;">
                    <div class="action-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="action-info">
                        <p class="action-label">목표 달성 실행 계획</p>
                        <h2 class="action-title">
                            목표 평단 <span id="target-price-val"></span> 달성을 위해<br>
                            <span class="action-highlight"><span id="target-shares-val">0</span>주</span>를 더 매수해야 합니다.
                        </h2>
                    </div>
                </div>

                <!-- 1. 핵심 요약 카드 -->
                <div class="insight-banner">
                    <div class="insight-item">
                        <span class="insight-label">평단가 변화</span>
                        <div class="insight-value-group">
                            <span class="old-value" id="res-old-avg">-</span>
                            <i class="fas fa-arrow-right"></i>
                            <span class="new-value" id="res-new-avg">-</span>
                        </div>
                        <span class="insight-change badge" id="res-avg-change">-</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-label">필요 투자금</span>
                        <span class="main-value" id="res-required-cost">-</span>
                        <span class="sub-value" id="res-required-cost-krw" style="display:none">-</span>
                    </div>
                </div>

                <!-- 2. 차트 영역 -->
                <div class="charts-container">
                    <div class="chart-box">
                        <h4><i class="fas fa-chart-pie"></i> 포트폴리오 비중</h4>
                        <div class="chart-wrapper">
                            <canvas id="weightChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-box">
                        <h4><i class="fas fa-ruler-vertical"></i> 평단가 위치 분석</h4>
                        <div class="chart-wrapper">
                            <canvas id="positionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 3. 상세 데이터 그리드 -->
                <div class="data-grid">
                    <div class="data-card">
                        <div class="card-header">📊 물타기 효과</div>
                        <div class="row">
                            <span>총 보유 수량</span>
                            <strong id="res-total-shares">-</strong>
                        </div>
                        <div class="row">
                            <span>총 투자 원금</span>
                            <strong id="res-total-invest">-</strong>
                        </div>
                        <div class="row" id="row-krw-total" style="display:none">
                            <span>원화 환산 총액</span>
                            <strong id="res-total-invest-krw">-</strong>
                        </div>
                    </div>

                    <div class="data-card">
                        <div class="card-header">🛡 리스크 & 목표</div>
                        <div class="row">
                            <span>현재 손익률</span>
                            <strong id="res-current-return">-</strong>
                        </div>
                        <div class="row">
                            <span>예상 손익률 (물타기 후)</span>
                            <strong id="res-new-return">-</strong>
                        </div>
                        <div class="row">
                            <span>원금 회복까지</span>
                            <strong id="res-recovery-rate" class="highlight">-</strong>
                        </div>
                    </div>
                </div>

                <!-- 4. 시나리오 -->
                <div class="scenario-box">
                    <h4>💡 수익 시나리오</h4>
                    <p id="scenario-text">주가가 이전 평단가 도달 시 ...</p>
                </div>
                
                <div class="watermark">Stock Pro Calculator</div>
            </div>
        </div>

        <!-- SEO 및 콘텐츠 가이드 섹션 (애드센스 최적화) -->
        <section class="content-guide-section">
            <article class="guide-article">
                <h2>📈 주식 물타기 계산기 100% 활용 가이드</h2>
                <p>
                    성공적인 투자를 위해서는 체계적인 자금 관리와 전략적인 분할 매수가 필수적입니다. 
                    <strong>Stock Pro 물타기 계산기</strong>는 단순한 수치 계산을 넘어, 투자자가 합리적인 의사결정을 내릴 수 있도록 돕는 전문 분석 도구입니다.
                </p>
                
                <h3>물타기(Dollar Cost Averaging)란?</h3>
                <p>
                    주가가 하락했을 때 추가 매수를 통해 평균 단가를 낮추는 투자 전략입니다. 
                    이를 통해 향후 주가가 반등할 때 손실을 더 빠르게 만회하고, 수익 전환 시점을 앞당길 수 있습니다. 
                    하지만 무분별한 물타기는 '깡통 계좌'의 지름길이 될 수 있으므로, 철저한 계산과 비중 관리가 선행되어야 합니다.
                </p>

                <h3>Stock Pro의 차별화된 기능</h3>
                <ul>
                    <li><strong>목표 평단 역계산:</strong> "내 평단을 $150까지 낮추려면 몇 주를 사야 할까?"라는 질문에 명확한 답을 제시합니다.</li>
                    <li><strong>이중 통화 지원:</strong> 미국 주식 투자 시 필수적인 실시간 환율을 반영하여, 원화(KRW) 기준의 정확한 투자 규모를 파악할 수 있습니다.</li>
                    <li><strong>시각적 리스크 분석:</strong> 현재 주가와 내 평단의 괴리율을 시각화된 차트로 제공하여 객관적인 상황 인식을 돕습니다.</li>
                </ul>

                <h3>투자 조언 및 주의사항</h3>
                <p>
                    분할 매수는 하락장에서 강력한 무기가 될 수 있지만, 펀더멘털이 훼손된 기업에 대해서는 신중해야 합니다. 
                    추가 매수 전에 반드시 해당 기업의 실적, 재무 건전성, 그리고 시장의 모멘텀을 다시 한번 확인하시기 바랍니다. 
                    또한, 전체 포트폴리오에서 특정 종목의 비중이 과도하게 커지지 않도록 리스크 관리에 만전을 기하십시오.
                </p>
            </article>

            <div class="disclaimer-box">
                <h4>⚠️ 면책 조항 (Disclaimer)</h4>
                <p>
                    본 서비스가 제공하는 계산 결과와 데이터는 투자 참고용이며, 그 정확성이나 완전성을 보장하지 않습니다. 
                    환율 변동, 증권사 수수료 정책, 시장 상황 등에 따라 실제 결과와 차이가 발생할 수 있습니다. 
                    모든 투자의 최종 책임은 투자자 본인에게 있으며, Stock Pro는 본 도구 사용으로 인한 어떠한 손실에 대해서도 책임을 지지 않습니다.
                </p>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>&copy; 2024 Stock Pro. Investment tools for professionals.</p>
    </footer>

    <script src="js/dashboard.js"></script>
    <script src="js/calculator.js"></script>
</body>
</html>